<script>
  //Variable Initializations
  let datass;
  let userId, userName; 
  let booking_list ; 
  //let data;

  var date_loading = new Date();
  var index_date = 0; // zero represents today date
  var list_events;
  const colors = ["Chartreuse","BlanchedAlmond","BlueViolet","BurlyWood","Chocolate","DarkSeaGreen","DeepPink","Gold"];
  const status_color = ["出社","外出","帰宅","直行","直帰","食事","休み","自宅作業"];
  //const number_of_users = document.getElementById("number_of_users").innerHTML;
  let number_of_users;

  var list_time = [];
  var interval = [];
  var flag_category = false;
  var flag_category2 = false;
  var list_name = [];
  const email_address_inbox = "https://mail.google.com/mail/u/0/#inbox";

  const mainTable=document.getElementById('table-main');

  data_from_ss();
  active_user(); 
  read_booking(); 
  getUserEmails();













  /*=================Functions============================*/

    function initialization(){
        document.getElementsByClassName('button')[0].id=`btn${userId}`
        document.getElementById('current-user').innerHTML=userName;
        console.log(document.getElementsByClassName('button')[0])
    }

    function data_from_ss(){
    google.script.run.withSuccessHandler(data=>{
      console.log(data)
      datass=data;
      number_of_users= datass.length;
      //initialLoad();
    }
    ).data_from_ss()
  }

  function active_user(){
    return google.script.run.withSuccessHandler(data=>{
      
      userId=data.index;
      userName=data.name;
      console.log(userId)
      initialization()
    }
    ).active_user()
  }

  function read_booking(){
    return google.script.run.withSuccessHandler(data=>{
      console.log(data)
      booking_list=data;
      
      fillTableWithData()
    }
    ).read_booking()
  }

  function getUserEmails(){
    google.script.run.withSuccessHandler(data1=>{
      console.log(data1)
      data=data1;
      let select =document.getElementById('msg_email');
       for (var i = 0; i < data.list_names.length; i++) { 
           let op=document.createElement('option')
           op.value=data.list_email[i]
           op.innerHTML=data.list_names[i]
           select.appendChild(op)          
            }    
    }
    ).getUserEmails()
  }

 

  function initialLoad(){
    for (var ii = 0 ; ii <= datass.length ; ii++){
        let rows=[]
          //Person info
          let tableRow=document.createElement('tr');
          //Number
          let tdNumber=document.createElement('td');
          tdNumber.classList.add('number')
          rows.push(tdNumber)
          //Name
          let tdName=document.createElement('td');
          tdName.classList.add('name')
          rows.push(tdName)
          //Status
          let tdStatus=document.createElement('td');
          tdStatus.classList.add('status')
          rows.push(tdStatus)
          //Note
          let tdNote=document.createElement('td');
          tdNote.classList.add('note')
          rows.push(tdNote)
          //Schedule
          let tdSchedule=document.createElement('td');
          tdSchedule.classList.add('schedule')
          rows.push(tdSchedule)

          //other
          let tdOther=document.createElement('td');
          tdOther.classList.add('other')
          rows.push(tdOther)

          //Append all table data to tableRow
          rows.forEach(row=>{
              tableRow.appendChild(row)
          })

          mainTable.appendChild(tableRow)
    }
    document.getElementById('table-loader').hidden=true
  }

  function fillTableWithData(){
    let i; 
    
    for (var ii = 0 ; ii <= datass.length ; ii++){
        let rows=[]
        if (ii == 0) {
            i = userId-1;
        } else if (ii == userId ){
            continue;
        } else {
            i = ii-1;
        } 
          //Person info
          let tableRow=document.createElement('tr');
          //Number
          let tdNumber=document.createElement('td');
          tdNumber.classList.add('number')
          let tdParaNum=document.createElement('p')
          tdParaNum.hidden=true;
          tdParaNum.innerHTML=i+1
          tdNumber.appendChild(tdParaNum)
          rows.push(tdNumber)

          //Name
          let tdName=document.createElement('td');
          tdName.classList.add('name')
          let tdParaName=document.createElement('p')
          tdParaName.style.textAlign='center';
          tdParaName.id=`name${i+1}`
          tdParaName.appendChild(document.createTextNode(datass[i][0]))
          tdName.appendChild(tdParaName)
          rows.push(tdName)
          
          //Status
          let tdStatus=document.createElement('td');
          tdStatus.classList.add('status')
          /*let tdParaStatus=document.createElement('p')
          tdParaStatus.style.width='100%';
          tdParaStatus.id=`statusT${i+1}`
          tdParaStatus.innerHTML=datass[i][i]
          tdStatus.appendChild(tdParaStatus)*/
          rows.push(tdStatus)
          //Note
          let tdNote=document.createElement('td');
          tdNote.classList.add('note')
          /*let tdParaNote=document.createElement('p')
          tdParaNote.id=`noteT${i+1}`
          tdParaNote.innerHTML=datass[i][2]
          tdNote.appendChild(tdParaNote)*/
          rows.push(tdNote)
          //Schedule
          let tdSchedule=document.createElement('td');
          tdSchedule.classList.add('schedule')
          /*let tdParaSchedule=document.createElement('p')
          let tdDivSchedule=document.createElement('div')

          tdParaSchedule.id=`schedule${i+1}`
          tdParaSchedule.innerHTML=datass[i][2]

          tdDivSchedule.classList.add('loader')
          tdDivSchedule.id=`schedule${i+1}`

          tdSchedule.appendChild(tdParaSchedule)
          tdSchedule.appendChild(tdDivSchedule)*/
          rows.push(tdSchedule)

          //other
          let tdOther=document.createElement('td');
          tdOther.classList.add('other')
          /*if(i+1 ===userId){
            let tdOtherUl=document.createElement('ul')
          tdOtherUl.id=`List${i+1}`
          let tdOtherPara=document.createElement('p')
          tdOtherPara.id=`calendarT${i+1}`
          tdOther.appendChild(tdOtherUl)
          tdOther.appendChild(tdOtherPara)

          }else{
            let tdOtherPara=document.createElement('p')
            tdOtherPara.id=`calendarT${i+1}`
            tdOtherPara.innerHTML=booking_list[i]
            tdOther.appendChild(tdOtherPara)

          }
          
          let tdOtherdiv1=document.createElement('div')
          tdOtherdiv1.classList.add('loader');
          tdOtherdiv1.id=`Loader${i+1}`
          tdOtherdiv1.hidden=true;
          let tdOtherdiv2=document.createElement('div')
          let tdOtherdiv2Button=document.createElement('button')
          tdOtherdiv2Button.classList.add('button')
          tdOtherdiv2Button.classList.add('disabled')
          
          tdOtherdiv2Button.id=`deleteBooking${i+1}`
          tdOtherdiv2Button.hidden=true;
          tdOtherdiv2Button.innerHTML='<i class="material-icons">delete</i>'
          tdOtherdiv2.appendChild(tdOtherdiv2Button);
          tdOther.appendChild(tdOtherdiv1)
          tdOther.appendChild(tdOtherdiv2)*/
          rows.push(tdOther)

          //Append all table data to tableRow
          rows.forEach(row=>{
              tableRow.appendChild(row)
          })

          mainTable.appendChild(tableRow)
        }
        document.getElementById('table-loader').hidden=true
    }
 

  
</script>